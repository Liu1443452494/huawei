"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Cart=void 0;var _createClass=function(){function n(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}return function(i,e,t){return e&&n(i.prototype,e),t&&n(i,t),i}}(),_tools=require("./tools.js");function _classCallCheck(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}var Cart=function(){function i(){_classCallCheck(this,i),this.url="http://10.31.161.144/huawei/php/",this.list_pro=(0,_tools.$)(".list-pro"),this.tool=(0,_tools.$)(".list-pro .totla_tool"),this.t_span=(0,_tools.$)(".total_price span","all")[1],this.pricearr=[],this.numobj=(0,_tools.$)(".total_choose em")}return _createClass(i,[{key:"init",value:function(){this.iscookie()}},{key:"iscookie",value:function(){if(_tools.jstool.getcookie("sidarr")&&_tools.jstool.getcookie("numarr")){this.sidarr=_tools.jstool.getcookie("sidarr").split(","),this.numarr=_tools.jstool.getcookie("numarr").split(",");for(var i=0;i<this.sidarr.length;i++)this.cartrender(this.sidarr[i],this.numarr[i])}}},{key:"cartrender",value:function(i,u){var g=this,f=this,e=i;(0,_tools.ajax)({url:this.url+"cart.php",data:{sid:e},dataType:"json"}).then(function(i){var e=document.createElement("div"),t="";t+='\n            <div class="pro_list">\n                <span class="checkbox l">\n                    <input type="text" sid='+i.sid+'>\n                </span>\n                <div class="pro_area l">\n                    <div class="pro_main">\n                        <a href="javascript:;">\n                            <img src="'+i.url+'" alt="">\n                        </a>\n                        <ul class="l">\n                            <li>\n                                <a href="javascript:;" class="des">\n                                    '+i.bdesc+'</a>\n                                <p>幻夜黑 全网通 6GB+64GB 官方标配</p>\n                            </li>\n                            <li>\n                                <div class="li_price"><span>¥ '+i.price+'.00</span></div>\n                            </li>\n                            <li>\n                                <div class="p_stock">\n                                    <a href="javascript:;" class="btn_left l" sid='+i.sid+'> -</a>\n                                    <input type="text" value="'+u+'" class="l">\n                                    <a href="javascript:;" class="btn_right" sid='+i.sid+'>+</a>\n                                </div>\n                            </li>\n                            <li>\n                                <div class="price_total">¥ '+u*i.price+'.00\n                                </div>\n                            </li>\n                            <li>\n                                <span class="del" sid='+i.sid+'>\n                                    删除\n                                </span>\n                            </li>\n                        </ul>\n                    </div>\n                    <div class="pro_server">\n                        <div class="server_list">\n                            <div class="server_info l">\n                                <span class="checkbox">\n                                    <input type="text">\n                                </span>\n                                <div class="server_name">\n                                    <span>碎屏(含后盖)服务宝1年</span>\n                                </div>\n                                <div class="server_price">\n                                    <span>¥169.00</span>\n                                </div>\n                            </div>\n                            <div class="server_link r">\n                                <a href="javascript:;">了解详情</a>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="pro_server">\n                        <div class="server_list">\n                            <div class="server_info l">\n                                <span class="checkbox">\n                                    <input type="text">\n                                </span>\n                                <div class="server_name">\n                                    <span>延长服务保</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            ',e.innerHTML=t,e.sid=i.sid,f.list_pro.insertBefore(e,f.list_pro.children[0]);for(var n=i.sid,r=(0,_tools.$)(".list_title .checkbox input"),s=f.list_pro.querySelectorAll(".pro_list>.checkbox>input"),a=(0,_tools.$)(".totla_tool .checkbox input"),l=0;l<s.length;l++)s[l].flag=!0,s[l].style.backgroundPosition="0 -129px";if(g.sidarr.length==s.length)for(var o=0;o<s.length;o++)s[o].onclick=function(){var i=this.parentNode.nextElementSibling.firstElementChild.children[1].children[3].firstElementChild.innerHTML;1==this.flag?(this.flag=!1,f.ischecked(s)?(r.flag=!0,a.flag=!0,r.style.backgroundPosition="0 -129px",a.style.backgroundPosition="0 -129px"):(r.flag=!1,a.flag=!1,r.style.backgroundPosition="-18px -129px",a.style.backgroundPosition="-18px -129px"),f.checkedchange_1(i.substring(2,i.indexOf(".")),this.getAttribute("sid"))):0==this.flag&&(this.flag=!0,f.ischecked(s)?(r.flag=!0,a.flag=!0,r.style.backgroundPosition="0 -129px",a.style.backgroundPosition="0 -129px"):(r.flag=!1,a.flag=!1,r.style.backgroundPosition="-18px -129px",a.style.backgroundPosition="-18px -129px"),f.checkedchange_2(i.substring(2,i.indexOf(".")),this.getAttribute("sid"))),1==this.flag?this.style.backgroundPosition="0 -129px":0==this.flag&&(this.style.backgroundPosition="-18px -129px")};r.flag=!0,a.flag=!0,r.style.backgroundPosition="0 -129px",a.style.backgroundPosition="0 -129px",f.ischecked_1(r,a,s),f.ischecked_1(a,r,s);var c=(0,_tools.$)(".price_total"),d=(0,_tools.$)(".btn_right"),h=(0,_tools.$)(".btn_left"),p=(0,_tools.$)(".li_price").firstElementChild;(0,_tools.$)(".pro_main .del").onclick=function(){var i=this.parentNode.previousElementSibling.firstElementChild.innerHTML;if(confirm("你确定要删除吗")){f.checkedchange_1(i.substring(2,i.indexOf(".")),this.getAttribute("sid")),f.list_pro.removeChild(this.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode);var e=f.sidarr.indexOf(this.getAttribute("sid"));f.sidarr.splice(e,1),f.numarr.splice(e,1),_tools.jstool.addcookie("sidarr",f.sidarr,30),_tools.jstool.addcookie("numarr",f.numarr,30)}},d.onclick=function(){f.addnum(this,c,p,this.getAttribute("sid")),f.t_change(c.innerHTML.substring(2,c.innerHTML.indexOf(".")),this.getAttribute("sid"))},h.onclick=function(){f.reducenum(this,c,p,this.getAttribute("sid")),f.t_change(c.innerHTML.substring(2,c.innerHTML.indexOf(".")),this.getAttribute("sid"))},f.totalprice(c.innerHTML.substring(2,c.innerHTML.indexOf(".")),n),f.numobj.innerHTML=g.pricearr.length})}},{key:"ischecked_1",value:function(i,r,s){var a=this;i.onclick=function(){if(1==this.flag?this.flag=!1:0==this.flag&&(this.flag=!0),1==this.flag){this.style.backgroundPosition="0 -129px",r.style.backgroundPosition="0 -129px",r.flag=!0,a.addchecked(s);for(var i=0;i<s.length;i++){var e=s[i].parentNode.nextElementSibling.firstElementChild.children[1].children[3].firstElementChild.innerHTML;a.checkedchange_2(e.substring(2,e.indexOf(".")),s[i].getAttribute("sid"))}}else if(0==this.flag){this.style.backgroundPosition="-18px -129px",r.style.backgroundPosition="-18px -129px",r.flag=!1,a.clearchecked(s);for(var t=0;t<s.length;t++){var n=s[t].parentNode.nextElementSibling.firstElementChild.children[1].children[3].firstElementChild.innerHTML;a.checkedchange_1(n.substring(2,n.indexOf(".")),s[t].getAttribute("sid"))}}}}},{key:"ischecked",value:function(i){for(var e=0,t=0;t<i.length;t++)0==i[t].flag&&(e=1);return 0==e||!(e=1)&&void 0}},{key:"clearchecked",value:function(i){for(var e=0;e<i.length;e++)i[e].flag=!1,0==i[e].flag&&(i[e].style.backgroundPosition="-18px -129px")}},{key:"addchecked",value:function(i){for(var e=0;e<i.length;e++)i[e].flag=!0,1==i[e].flag&&(i[e].style.backgroundPosition="0 -129px")}},{key:"addnum",value:function(i,e,t,n){var r=t.innerHTML.substring(2,t.innerHTML.indexOf(".")),s=parseInt(i.previousElementSibling.value)+1;i.previousElementSibling.value=s,e.innerHTML="¥ "+s*r+".00 ",i.previousElementSibling.previousElementSibling.style.cursor="pointer",this.numarr[this.sidarr.indexOf(n)]=s.toString(),_tools.jstool.addcookie("numarr",this.numarr,30)}},{key:"reducenum",value:function(i,e,t,n){var r=t.innerHTML.substring(2,t.innerHTML.indexOf(".")),s=parseInt(i.nextElementSibling.value)-1;s<=1?(s=1,i.style.cursor=" no-drop"):i.style.cursor="pointer",i.nextElementSibling.value=s,e.innerHTML="¥ "+s*r+".00 ",this.numarr[this.sidarr.indexOf(n)]=s.toString(),_tools.jstool.addcookie("numarr",this.numarr,30)}},{key:"totalprice",value:function(i,e){this.pricearr.push([i,e]),this.pricearr.length===this.sidarr.length&&this.addtprice()}},{key:"checkedchange_1",value:function(i){for(var e=0;e<this.pricearr.length;e++)i==this.pricearr[e][0]&&(this.pricearr.splice(e,1),this.addtprice())}},{key:"checkedchange_2",value:function(i,e){for(var t=0,n=0;n<this.pricearr.length;n++)this.pricearr[n][1]==e&&(t=1);0==t&&this.pricearr.push([i,e]),this.addtprice()}},{key:"t_change",value:function(i,e){for(var t=0;t<this.pricearr.length;t++)e==this.pricearr[t][1]&&(this.pricearr[t][0]=i,this.addtprice())}},{key:"addtprice",value:function(){for(var i=0,e=0;e<this.pricearr.length;e++)i+=parseInt(this.pricearr[e][0]);this.t_span.innerHTML="¥  "+i+".00",this.numobj.innerHTML=this.pricearr.length}}]),i}();exports.Cart=Cart;